//     Backbone.js 0.9.2

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org
(function(){var e=this,t=e.Backbone,n=Array.prototype,r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={};o.VERSION="0.9.2";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore"));o.$=e.jQuery||e.Zepto||e.ender;o.noConflict=function(){e.Backbone=t;return this};o.emulateHTTP=!1;o.emulateJSON=!1;var a=/\s+/,f=o.Events={on:function(e,t,n){var r,i,s;if(!t)return this;e=e.split(a);r=this._callbacks||(this._callbacks={});while(i=e.shift()){s=r[i]||(r[i]=[]);s.push(t,n)}return this},off:function(e,t,n){var r,i,s,o;if(!(i=this._callbacks))return this;if(!(e||t||n)){delete this._callbacks;return this}e=e?e.split(a):u.keys(i);while(r=e.shift()){if(!(s=i[r])||!t&&!n){delete i[r];continue}for(o=s.length-2;o>=0;o-=2)t&&s[o]!==t||n&&s[o+1]!==n||s.splice(o,2)}return this},trigger:function(e){var t,n,r,i,s,o,u,f;if(!(n=this._callbacks))return this;f=[];e=e.split(a);for(i=1,s=arguments.length;i<s;i++)f[i-1]=arguments[i];while(t=e.shift()){if(u=n.all)u=u.slice();if(r=n[t])r=r.slice();if(r)for(i=0,s=r.length;i<s;i+=2)r[i].apply(r[i+1]||this,f);if(u){o=[t].concat(f);for(i=0,s=u.length;i<s;i+=2)u[i].apply(u[i+1]||this,o)}}return this}};f.bind=f.on;f.unbind=f.off;var l=o.Model=function(e,t){var n,r=e||{};t&&t.collection&&(this.collection=t.collection);this.attributes={};this._escapedAttributes={};this.cid=u.uniqueId("c");this.changed={};this._changes={};this._pending={};t&&t.parse&&(r=this.parse(r));if(n=u.result(this,"defaults"))r=u.extend({},n,r);this.set(r,{silent:!0});this.changed={};this._changes={};this._pending={};this._previousAttributes=u.clone(this.attributes);this.initialize.apply(this,arguments)};u.extend(l.prototype,f,{changed:null,_changes:null,_pending:null,_changing:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.get(e);return this._escapedAttributes[e]=u.escape(n==null?"":""+n)},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i;if(e==null)return this;if(u.isObject(e)){i=e;n=t}else(i={})[e]=t;var s=n&&n.silent,o=n&&n.unset;i instanceof l&&(i=i.attributes);if(o)for(r in i)i[r]=void 0;if(!this._validate(i,n))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var a=this._changing,f=this.attributes,c=this._escapedAttributes,h=this._previousAttributes||{};for(r in i){t=i[r];if(!u.isEqual(f[r],t)||o&&u.has(f,r)){delete c[r];this._changes[r]=!0}o?delete f[r]:f[r]=t;if(!u.isEqual(h[r],t)||u.has(f,r)!==u.has(h,r)){this.changed[r]=t;s||(this._pending[r]=!0)}else{delete this.changed[r];delete this._pending[r];a||delete this._changes[r]}a&&u.isEqual(f[r],a[r])&&delete this._changes[r]}s||this.change(n);return this},unset:function(e,t){t=u.extend({},t,{unset:!0});return this.set(e,null,t)},clear:function(e){e=u.extend({},e,{unset:!0});return this.set(u.clone(this.attributes),e)},fetch:function(e){e=e?u.clone(e):{};var t=this,n=e.success;e.success=function(r,i,s){if(!t.set(t.parse(r,s),e))return!1;n&&n(t,r,e)};return this.sync("read",this,e)},save:function(e,t,n){var r,i,s;if(e==null||u.isObject(e)){r=e;n=t}else e!=null&&((r={})[e]=t);n=n?u.clone(n):{};if(n.wait){if(!this._validate(r,n))return!1;i=u.clone(this.attributes)}var o=u.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?o:n))return!1;if(!r&&!this._validate(null,n))return!1;var a=this,f=n.success;n.success=function(e,t,i){s=!0;var o=a.parse(e,i);n.wait&&(o=u.extend(r||{},o));if(!a.set(o,n))return!1;f&&f(a,e,n)};var l=this.sync(this.isNew()?"create":"update",this,n);if(!s&&n.wait){this.clear(o);this.set(i,o)}return l},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r();n&&n(t,i,e)};if(this.isNew()){e.success();return!1}var i=this.sync("delete",this,e);e.wait||r();return i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||A();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(e){var t=this._changing,n=this._changing={};for(var r in this._changes)this._pending[r]=!0;var i=this._changes;this._changes={};var s=[];for(var r in i){n[r]=this.get(r);s.push(r)}for(var o=0,a=s.length;o<a;o++)this.trigger("change:"+s[o],this,n[s[o]],e);if(t)return this;while(!u.isEmpty(this._pending)){this._pending={};this.trigger("change",this,e);for(var r in this.changed){if(this._pending[r]||this._changes[r])continue;delete this.changed[r]}this._previousAttributes=u.clone(this.attributes)}this._changing=null;return this},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._previousAttributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(t&&t.silent||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validate(e,t);if(!n)return!0;t&&t.error&&t.error(this,n,t);this.trigger("error",this,n,t);return!1}});var c=o.Collection=function(e,t){t||(t={});t.model&&(this.model=t.model);t.comparator!==void 0&&(this.comparator=t.comparator);this._reset();this.initialize.apply(this,arguments);if(e){t.parse&&(e=this.parse(e));this.reset(e,{silent:!0,parse:t.parse})}};u.extend(c.prototype,f,{model:l,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){var n,i,o,a,f,l=t&&t.at;e=u.isArray(e)?e.slice():[e];for(n=0,o=e.length;n<o;n++){if(e[n]=this._prepareModel(e[n],t))continue;throw new Error("Can't add an invalid model to a collection")}for(n=e.length-1;n>=0;n--){a=e[n];f=a.id!=null&&this._byId[a.id];if(f||this._byCid[a.cid]){t&&t.merge&&f&&f.set(a,t);e.splice(n,1);continue}a.on("all",this._onModelEvent,this);this._byCid[a.cid]=a;a.id!=null&&(this._byId[a.id]=a)}this.length+=e.length;i=[l!=null?l:this.models.length,0];r.apply(i,e);s.apply(this.models,i);this.comparator&&l==null&&this.sort({silent:!0});if(t&&t.silent)return this;while(a=e.shift())a.trigger("add",a,this,t);return this},remove:function(e,t){var n,r,i,s;t||(t={});e=u.isArray(e)?e.slice():[e];for(n=0,r=e.length;n<r;n++){s=this.getByCid(e[n])||this.get(e[n]);if(!s)continue;delete this._byId[s.id];delete this._byCid[s.cid];i=this.indexOf(s);this.models.splice(i,1);this.length--;if(!t.silent){t.index=i;s.trigger("remove",s,this,t)}this._removeReference(s)}return this},push:function(e,t){e=this._prepareModel(e,t);this.add(e,t);return e},pop:function(e){var t=this.at(this.length-1);this.remove(t,e);return t},unshift:function(e,t){e=this._prepareModel(e,t);this.add(e,u.extend({at:0},t));return e},shift:function(e){var t=this.at(0);this.remove(t,e);return t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return u.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this));(!e||!e.silent)&&this.trigger("reset",this,e);return this},pluck:function(e){return u.invoke(this.models,"get",e)},reset:function(e,t){for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);this._reset();e&&this.add(e,u.extend({silent:!0},t));(!t||!t.silent)&&this.trigger("reset",this,t);return this},fetch:function(e){e=e?u.clone(e):{};e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;e.success=function(r,i,s){t[e.add?"add":"reset"](t.parse(r,s),e);n&&n(t,r,e)};return this.sync("read",this,e)},create:function(e,t){var n=this;t=t?u.clone(t):{};e=this._prepareModel(e,t);if(!e)return!1;t.wait||n.add(e,t);var r=t.success;t.success=function(e,t,i){i.wait&&n.add(e,i);r&&r(e,t,i)};e.save(null,t);return e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},chain:function(){return u(this.models).chain()},_reset:function(e){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(e,t){if(e instanceof l){e.collection||(e.collection=this);return e}t||(t={});t.collection=this;var n=new this.model(e,t);return n._validate(n.attributes,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection;e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r);if(t&&e==="change:"+t.idAttribute){delete this._byId[t.previous(t.idAttribute)];t.id!=null&&(this._byId[t.id]=t)}this.trigger.apply(this,arguments)}});var h=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortedIndex","toArray","size","first","head","take","initial","rest","tail","last","without","indexOf","shuffle","lastIndexOf","isEmpty"];u.each(h,function(e){c.prototype[e]=function(){var t=i.call(arguments);t.unshift(this.models);return u[e].apply(u,t)}});var p=["groupBy","countBy","sortBy"];u.each(p,function(e){c.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var d=o.Router=function(e){e||(e={});e.routes&&(this.routes=e.routes);this._bindRoutes();this.initialize.apply(this,arguments)},v=/\((.*?)\)/g,m=/:\w+/g,g=/\*\w+/g,y=/[-{}[\]+?.,\\^$|#\s]/g;u.extend(d.prototype,f,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e));n||(n=this[t]);o.history.route(e,u.bind(function(r){var i=this._extractParameters(e,r);n&&n.apply(this,i);this.trigger.apply(this,["route:"+t].concat(i));o.history.trigger("route",this,t,i)},this));return this},navigate:function(e,t){o.history.navigate(e,t);return this},_bindRoutes:function(){if(!this.routes)return;var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){e=e.replace(y,"\\$&").replace(v,"(?:$1)?").replace(m,"([^/]+)").replace(g,"(.*?)");return new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var b=o.History=function(){this.handlers=[];u.bindAll(this,"checkUrl");if(typeof window!="undefined"){this.location=window.location;this.history=window.history}},w=/^[#\/]|\s+$/,E=/^\/+|\/+$/g,S=/msie [\w.]+/,x=/\/$/;b.started=!1;u.extend(b.prototype,f,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(x,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return decodeURIComponent(e.replace(w,""))},start:function(e){if(b.started)throw new Error("Backbone.history has already been started");b.started=!0;this.options=u.extend({},{root:"/"},this.options,e);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==!1;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=S.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(E,"/");if(r&&this._wantsHashChange){this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(t)}this._hasPushState?o.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s){this.fragment=this.getFragment(null,!0);this.location.replace(this.root+this.location.search+"#"+this.fragment);return!0}if(this._wantsPushState&&this._hasPushState&&s&&i.hash){this.fragment=this.getHash().replace(w,"");this.history.replaceState({},document.title,this.root+this.fragment+i.search)}if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);b.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=u.any(this.handlers,function(e){if(e.route.test(t)){e.callback(t);return!0}});return n},navigate:function(e,t){if(!b.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace);if(this.iframe&&e!==this.getFragment(this.getHash(this.iframe))){t.replace||this.iframe.document.open().close();this._updateHash(this.iframe.location,e,t.replace)}}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}});o.history=new b;var T=o.View=function(e){this.cid=u.uniqueId("view");this._configure(e||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},N=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName"];u.extend(T.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},dispose:function(){this.undelegateEvents();this.model&&this.model.off&&this.model.off(null,null,this);this.collection&&this.collection.off&&this.collection.off(null,null,this);return this},remove:function(){this.dispose();this.$el.remove();return this},make:function(e,t,n){var r=document.createElement(e);t&&o.$(r).attr(t);n!=null&&o.$(r).html(n);return r},setElement:function(e,t){this.$el&&this.undelegateEvents();this.$el=e instanceof o.$?e:o.$(e);this.el=this.$el[0];t!==!1&&this.delegateEvents();return this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)throw new Error('Method "'+e[t]+'" does not exist');var r=t.match(N),i=r[1],s=r[2];n=u.bind(n,this);i+=".delegateEvents"+this.cid;s===""?this.$el.bind(i,n):this.$el.delegate(s,i,n)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=u.extend({},this.options,e));u.extend(this,u.pick(e,C));this.options=e},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id"));this.className&&(e["class"]=u.result(this,"className"));this.setElement(this.make(u.result(this,"tagName"),e),!1)}else this.setElement(u.result(this,"el"),!1)}});var k={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};o.sync=function(e,t,n){var r=k[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||A());if(!n.data&&t&&(e==="create"||e==="update")){i.contentType="application/json";i.data=JSON.stringify(t)}if(n.emulateJSON){i.contentType="application/x-www-form-urlencoded";i.data=i.data?{model:i.data}:{}}if(n.emulateHTTP&&(r==="PUT"||r==="DELETE")){i.type="POST";n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1);var a=n.success;n.success=function(e,r,i){a&&a(e,r,i);t.trigger("sync",t,e,n)};var f=n.error;n.error=function(e,r,i){f&&f(t,e,n);t.trigger("error",t,e,n)};return o.ajax(u.extend(i,n))};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var L=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){n.apply(this,arguments)};u.extend(r,n,t);var i=function(){this.constructor=r};i.prototype=n.prototype;r.prototype=new i;e&&u.extend(r.prototype,e);r.__super__=n.prototype;return r};l.extend=c.extend=d.extend=T.extend=b.extend=L;var A=function(){throw new Error('A "url" property or function must be specified')}}).call(this);